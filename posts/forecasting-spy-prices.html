<!DOCTYPE html><html><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-193041393-1"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-193041393-1', {
              page_path: window.location.pathname,
            });
          </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"/><link rel="preload" href="/fonts/FiraCode-VariableFont_wght.ttf" as="font" crossorigin="anonymous"/><link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 100 100&#x27;&gt;&lt;text y=&#x27;.9em&#x27; font-size=&#x27;90&#x27;&gt;üëã&lt;/text&gt;&lt;/svg&gt;"/><meta name="description" content="Using Facebook‚Äôs Prophet, an open-source, time series forecasting procedure to predict SPY (SPDR S&amp;P 500 ETF Trust) closing prices."/><meta property="og:image" content="https://og-image.vercel.app/Forecasting%20SPY%20prices%20using%20Facebook&#x27;s%20Prophet.png?theme=light&amp;md=1&amp;fontSize=50px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-color-logo.svg&amp;widths=350&amp;heights=350"/><meta name="robots" content="follow, index"/><meta name="og:title" content="Forecasting SPY prices using Facebook&#x27;s Prophet"/><meta property="og:site_name" content="Forecasting SPY prices using Facebook&#x27;s Prophet"/><meta property="og:description" content="Using Facebook‚Äôs Prophet, an open-source, time series forecasting procedure to predict SPY (SPDR S&amp;P 500 ETF Trust) closing prices."/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@bschoeneweis"/><meta name="twitter:title" content="Bradley Schoeneweis"/><meta name="twitter:description" content="Using Facebook‚Äôs Prophet, an open-source, time series forecasting procedure to predict SPY (SPDR S&amp;P 500 ETF Trust) closing prices."/><meta name="twitter:image" content="https://og-image.vercel.app/Forecasting%20SPY%20prices%20using%20Facebook&#x27;s%20Prophet.png?theme=light&amp;md=1&amp;fontSize=50px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-color-logo.svg&amp;widths=350&amp;heights=350"/><title>Forecasting SPY prices using Facebook&#x27;s Prophet</title><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/06dea8e0c799365a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/06dea8e0c799365a.css" data-n-g=""/><link rel="preload" href="/_next/static/css/ca686f70eb553c6d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ca686f70eb553c6d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-45b7663f25500b57.js" defer=""></script><script src="/_next/static/chunks/framework-7d488969745094b0.js" defer=""></script><script src="/_next/static/chunks/main-c3ed9a593ffd1a6c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d542c2ab22c8ff03.js" defer=""></script><script src="/_next/static/chunks/4824-86805e89d9bc00a3.js" defer=""></script><script src="/_next/static/chunks/494-a7f972c4001b17a3.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-5ce02025a16a43fb.js" defer=""></script><script src="/_next/static/PhTuDHTOFIz8jI2R6saCy/_buildManifest.js" defer=""></script><script src="/_next/static/PhTuDHTOFIz8jI2R6saCy/_ssgManifest.js" defer=""></script><script src="/_next/static/PhTuDHTOFIz8jI2R6saCy/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="layout_ArticleContainer__QR4qB"><header><div class="layout_LayoutLinks__92rCe"><a href="/">‚Üê Back home</a></div></header><main><article><h1 class="utils_headingXl__u25Y2">Forecasting SPY prices using Facebook&#x27;s Prophet</h1><div class="tag_TagList__IWJKV tag_TagListPost__iMXoV"><div class="utils_displayFlex__VCtvW"><a href="/tags/python"><div><span class="tag_Badge__e6qwu utils_cursorPointer__oXutf">python</span></div></a></div><div class="utils_displayFlex__VCtvW"><a href="/tags/pandas"><div><span class="tag_Badge__e6qwu utils_cursorPointer__oXutf">pandas</span></div></a></div><div class="utils_displayFlex__VCtvW"><a href="/tags/data-analysis"><div><span class="tag_Badge__e6qwu utils_cursorPointer__oXutf">data-analysis</span></div></a></div></div><div class="author_Author__QmrQi"><img loading="eager" src="/images/profile.jpg" height="40" width="40" alt="Bradley Schoeneweis" class="utils_borderCircle__s2nTm author_AuthorImage__6NLD6"/><div class="utils_lightText__eUzGY author_AuthorDate__HzPM6">Bradley Schoeneweis<span class="utils_dotSeparator__Ij4lk">‚Ä¢</span><time dateTime="2021-05-19">May 19, 2021</time></div></div><h2>tl;dr</h2>
<h3>Goal</h3>
<p><em>To apply Facebook&#x27;s Prophet forecasting procedure to historical SPY (SPDR S&amp;P 500 ETF Trust) market data to gather future pricing predictions.</em></p>
<h3>A few notes</h3>
<ul>
<li>I&#x27;m by no means a data scientist, so this is more of an exploratory analysis than an accurate one</li>
<li>For sake of brevity, I won&#x27;t be using a training/test split or measuring the error of the model, I will just train the model on the entire dataset and then make a prediction</li>
</ul>
<h3>Process overview</h3>
<ol>
<li><strong>Downloading the data</strong> - exporting the data from Yahoo Finance as a CSV</li>
<li><strong>Exploring the data</strong> - loading and exploring the data using Pandas</li>
<li><strong>Fitting the model</strong> - reading in the data and applying a basic fit of the Prophet model to the data</li>
<li><strong>Visualizing the forecast</strong> - visualizing the forecasted pricing data</li>
</ol>
<h3>Python dependencies</h3>
<pre><div class="codeblock_CodeBlock__P_tQD"><div class="sc-gsDKAQ bnYxmP"><span style="font-size:inherit;font-family:inherit;background:#282c34;color:#abb2bf;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px;float:left;padding-right:10px"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span></code><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px">import pandas as pd
from prophet import Prophet</code></span><button type="button" class="sc-bdvvtL dHMcRP"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="#abb2bf"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div></pre>
<p style="background-color:orange;padding:7px 20px;border-radius:6px">
    <b>Important</b> This article is not investment advice, please conduct your own due diligence. This is merely a simple analysis.
</p>
<hr/>
<p>Before we jump in, let&#x27;s give a little background on SPY and on Facebook&#x27;s Prophet.</p>
<p>The <em>SPDR S&amp;P 500 ETF Trust</em> (SPY) is an ETF (<em>Exchange Traded Fund</em>) that tracks the performance of the S&amp;P 500 index.  SPY is also the largest ETF in the world, and is popular compared to other ETFs that track the S&amp;P 500 because of the high volume, or the number of shares that trade on a given day (we&#x27;ll be able to see the volume per day in the CSV we export from Yahoo Finance).</p>
<p>For more information on ETFs, <a href="https://www.investopedia.com/terms/e/etf.asp" target="_blank">Investopedia gives a good overview</a>.</p>
<p><a href="https://facebook.github.io/prophet/" target="_blank">Facebook Prophet</a> is an open source, automated forecasting procedure for time series data.  I&#x27;m not going to dive too much into the mathematics or implementation details of Prophet, but if you are more interested, you can read the <a href="https://peerj.com/preprints/3190/" target="_blank">research paper</a>.  Prophet makes it easy to handle outliers, adjust to different time intervals, deal with holidays, and leaves the ability to easily tune the forecasting model.</p>
<p>Now that we have a general idea of what we&#x27;re trying to predict and the tool we&#x27;ll use to forecast, let&#x27;s dive into the actual data.</p>
<hr/>
<h2>Downloading the data</h2>
<p>Thanks to Yahoo Finance, we can download historical pricing data for free. You can click <a href="https://finance.yahoo.com/quote/SPY/history?p=SPY" target="_blank">here</a> to view the SPY historical pricing data.</p>
<p>Click on the <code style="font-family:Fira Code;border:none;font-variant-ligatures:none;background-color:rgb(246, 249, 252);padding:3px;border-radius:3px">Historical Data</code> tab, and then we can adjust our <code style="font-family:Fira Code;border:none;font-variant-ligatures:none;background-color:rgb(246, 249, 252);padding:3px;border-radius:3px">Time Period</code> to the Max as seen below (back to January 1993).</p>
<div style="display:flex;justify-content:center" class="ZoomImageWrapper"><label><input type="checkbox" class="utils_displayNone__rveqn"/><img src="/images/forecasting-spy/export-data.jpg" width="680" height="243" class="postImg" alt="Historical pricing data" loading="eager"/></label></div>
<p>Now we can click download to get our CSV and start diving into the data.</p>
<hr/>
<h2>Exploring the data</h2>
<p>Let&#x27;s fire up Pandas and load our data into a DataFrame to see what general insights we can extract.</p>
<pre><div class="codeblock_CodeBlock__P_tQD"><div class="sc-gsDKAQ bnYxmP"><span style="font-size:inherit;font-family:inherit;background:#282c34;color:#abb2bf;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px;float:left;padding-right:10px"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span><span class="react-syntax-highlighter-line-number">15
</span><span class="react-syntax-highlighter-line-number">16
</span><span class="react-syntax-highlighter-line-number">17
</span><span class="react-syntax-highlighter-line-number">18
</span><span class="react-syntax-highlighter-line-number">19
</span><span class="react-syntax-highlighter-line-number">20
</span><span class="react-syntax-highlighter-line-number">21
</span><span class="react-syntax-highlighter-line-number">22
</span><span class="react-syntax-highlighter-line-number">23
</span><span class="react-syntax-highlighter-line-number">24
</span><span class="react-syntax-highlighter-line-number">25
</span><span class="react-syntax-highlighter-line-number">26
</span><span class="react-syntax-highlighter-line-number">27
</span><span class="react-syntax-highlighter-line-number">28
</span><span class="react-syntax-highlighter-line-number">29
</span><span class="react-syntax-highlighter-line-number">30
</span><span class="react-syntax-highlighter-line-number">31
</span><span class="react-syntax-highlighter-line-number">32
</span><span class="react-syntax-highlighter-line-number">33
</span><span class="react-syntax-highlighter-line-number">34
</span><span class="react-syntax-highlighter-line-number">35
</span><span class="react-syntax-highlighter-line-number">36
</span><span class="react-syntax-highlighter-line-number">37
</span><span class="react-syntax-highlighter-line-number">38
</span><span class="react-syntax-highlighter-line-number">39
</span><span class="react-syntax-highlighter-line-number">40
</span><span class="react-syntax-highlighter-line-number">41
</span><span class="react-syntax-highlighter-line-number">42
</span><span class="react-syntax-highlighter-line-number">43
</span><span class="react-syntax-highlighter-line-number">44
</span><span class="react-syntax-highlighter-line-number">45
</span><span class="react-syntax-highlighter-line-number">46
</span><span class="react-syntax-highlighter-line-number">47
</span><span class="react-syntax-highlighter-line-number">48
</span><span class="react-syntax-highlighter-line-number">49
</span><span class="react-syntax-highlighter-line-number">50
</span><span class="react-syntax-highlighter-line-number">51
</span><span class="react-syntax-highlighter-line-number">52
</span><span class="react-syntax-highlighter-line-number">53
</span><span class="react-syntax-highlighter-line-number">54
</span><span class="react-syntax-highlighter-line-number">55
</span><span class="react-syntax-highlighter-line-number">56
</span><span class="react-syntax-highlighter-line-number">57
</span><span class="react-syntax-highlighter-line-number">58
</span><span class="react-syntax-highlighter-line-number">59
</span></code><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px">df = pd.read_csv(&#x27;SPY.csv&#x27;)

# Columns and row count
df.info()
&quot;&quot;&quot;
&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;
RangeIndex: 7125 entries, 0 to 7124
Data columns (total 7 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Date       7125 non-null   object 
 1   Open       7125 non-null   float64
 2   High       7125 non-null   float64
 3   Low        7125 non-null   float64
 4   Close      7125 non-null   float64
 5   Adj Close  7125 non-null   float64
 6   Volume     7125 non-null   int64  
dtypes: float64(5), int64(1), object(1)
memory usage: 389.8+ KB
&quot;&quot;&quot;

# Preview of the data
df.head()
&quot;&quot;&quot;
         Date      Open      High       Low     Close  Adj Close   Volume
0  1993-01-29  43.96875  43.96875  43.75000  43.93750  25.884184  1003200
1  1993-02-01  43.96875  44.25000  43.96875  44.25000  26.068277   480500
2  1993-02-02  44.21875  44.37500  44.12500  44.34375  26.123499   201300
3  1993-02-03  44.40625  44.84375  44.37500  44.81250  26.399649   529400
4  1993-02-04  44.96875  45.09375  44.46875  45.00000  26.510111   531500
&quot;&quot;&quot;

# General statistics
df.describe().loc[[&#x27;mean&#x27;, &#x27;min&#x27;, &#x27;max&#x27;]]
&quot;&quot;&quot;
            Open        High         Low       Close   Adj Close        Volume
mean  146.896395  147.766581  145.928716  146.896373  121.611954  8.453727e+07
min    43.343750   43.531250   42.812500   43.406250   25.571209  5.200000e+03
max   422.500000  422.820007  419.160004  422.119995  422.119995  8.710263e+08
&quot;&quot;&quot;

# Day to day percent changes of Highs
df[[&#x27;Date&#x27;, &#x27;High&#x27;]].set_index(&#x27;Date&#x27;).pct_change().reset_index()
&quot;&quot;&quot;
            Date      High
0     1993-01-29       NaN
1     1993-02-01  0.006397
2     1993-02-02  0.002825
3     1993-02-03  0.010563
4     1993-02-04  0.005575
         ...       ...
7120  2021-05-10 -0.000189
7121  2021-05-11 -0.017670
7122  2021-05-12 -0.006454
7123  2021-05-13 -0.000582
7124  2021-05-14  0.012465

[7125 rows x 2 columns]
&quot;&quot;&quot;</code></span><button type="button" class="sc-bdvvtL dHMcRP"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="#abb2bf"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div></pre>
<p>Now that we know a bit more about our data in general, we can create a model using Prophet.</p>
<hr/>
<h2>Fitting the model</h2>
<p>Since we&#x27;re not concerned in this post about making our model the best it can be, we can train our model on the entire dataset.</p>
<p>This typically isn&#x27;t a good practice.  When trying to make an accurate prediction, you should use training and test subsets of the data and calculate errors within your model and use those results to tune hyperparameters.</p>
<p>Nevertheless, let&#x27;s continue.</p>
<pre><div class="codeblock_CodeBlock__P_tQD"><div class="sc-gsDKAQ bnYxmP"><span style="font-size:inherit;font-family:inherit;background:#282c34;color:#abb2bf;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px;float:left;padding-right:10px"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span><span class="react-syntax-highlighter-line-number">15
</span><span class="react-syntax-highlighter-line-number">16
</span><span class="react-syntax-highlighter-line-number">17
</span><span class="react-syntax-highlighter-line-number">18
</span><span class="react-syntax-highlighter-line-number">19
</span><span class="react-syntax-highlighter-line-number">20
</span></code><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px"># The prophet model fits to a DataFrame with a date column (ds)
# and a value to predict (y)
df_predict = df[[&#x27;Date&#x27;, &#x27;Close&#x27;]]
df_predict.columns = [&#x27;ds&#x27;, &#x27;y&#x27;]

# We can find all of the missing days within our dataset
# and mark those as &quot;holidays&quot;
date_series = pd.to_datetime(df[&#x27;Date&#x27;])
df_missing_dates = pd\
    .date_range(start=date_series.min(), end=date_series.max())\
    .difference(date_series)\
    .to_frame()\
    .reset_index()
df_missing_dates.columns = [&#x27;holiday&#x27;, &#x27;ds&#x27;]
df_missing_dates[&#x27;holiday&#x27;] = &#x27;Stock Market Closed&#x27;

# Fitting our model is incredibly simple and can be done in the
# most basic sense in just two lines of code
m = Prophet(daily_seasonality=True, holidays=df_missing_dates)
m.fit(df_predict)</code></span><button type="button" class="sc-bdvvtL dHMcRP"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="#abb2bf"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div></pre>
<p>Just like that, we have built our model for a forecast.  All we have left to do is generate dates to predict values for, and run the actual prediction.</p>
<hr/>
<h2>Visualizing the forecast</h2>
<p>Now let&#x27;s forecast with our model and visualize the results.</p>
<pre><div class="codeblock_CodeBlock__P_tQD"><div class="sc-gsDKAQ bnYxmP"><span style="font-size:inherit;font-family:inherit;background:#282c34;color:#abb2bf;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px;float:left;padding-right:10px"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span></code><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px"># Create a DataFrame with past and future dates (only weekdays)
future = m.make_future_dataframe(periods=365)
future = future[pd.to_datetime(future[&#x27;ds&#x27;]).dt.weekday &lt; 5]

# Now we can forecast and visualize in just two more lines of code
forecast = m.predict(future)
m.plot(forecast, xlabel=&#x27;Date&#x27;, ylabel=&#x27;Daily Closing Price&#x27;)</code></span><button type="button" class="sc-bdvvtL dHMcRP"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="#abb2bf"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div></pre>
<div style="display:flex;justify-content:center" class="ZoomImageWrapper"><label><input type="checkbox" class="utils_displayNone__rveqn"/><img src="/images/forecasting-spy/first-prediction.jpg" width="800" height="480" class="postImg" alt="First SPY forecast" loading="lazy"/></label></div>
<blockquote>
<p><strong>A few things to notice</strong></p>
<ul>
<li>The black dots are the training data points</li>
<li>The blue outline is the confidence interval</li>
<li>The line within the confidence interval is the actual forecast</li>
</ul>
</blockquote>
<p>Based on our results, we can see the forecast is fairly linear and the confidence interval is relatively narrow (due to the volume of date).  The behavior of the stock market since Covid-19 started back around February 2020 has be a little unorthodox, so let&#x27;s narrow our model to be trained back to data starting in 2017 to see if there is an effect.</p>
<pre><div class="codeblock_CodeBlock__P_tQD"><div class="sc-gsDKAQ bnYxmP"><span style="font-size:inherit;font-family:inherit;background:#282c34;color:#abb2bf;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px;float:left;padding-right:10px"><span class="react-syntax-highlighter-line-number">1
</span><span class="react-syntax-highlighter-line-number">2
</span><span class="react-syntax-highlighter-line-number">3
</span><span class="react-syntax-highlighter-line-number">4
</span><span class="react-syntax-highlighter-line-number">5
</span><span class="react-syntax-highlighter-line-number">6
</span><span class="react-syntax-highlighter-line-number">7
</span><span class="react-syntax-highlighter-line-number">8
</span><span class="react-syntax-highlighter-line-number">9
</span><span class="react-syntax-highlighter-line-number">10
</span><span class="react-syntax-highlighter-line-number">11
</span><span class="react-syntax-highlighter-line-number">12
</span><span class="react-syntax-highlighter-line-number">13
</span><span class="react-syntax-highlighter-line-number">14
</span><span class="react-syntax-highlighter-line-number">15
</span><span class="react-syntax-highlighter-line-number">16
</span><span class="react-syntax-highlighter-line-number">17
</span><span class="react-syntax-highlighter-line-number">18
</span><span class="react-syntax-highlighter-line-number">19
</span><span class="react-syntax-highlighter-line-number">20
</span><span class="react-syntax-highlighter-line-number">21
</span><span class="react-syntax-highlighter-line-number">22
</span></code><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px"># Narrow down to start at 2017
df_recent_predict = df_predict.iloc[date_series[date_series.dt.year &gt; 2016].index]
date_series = pd.to_datetime(df_recent_predict[&#x27;ds&#x27;])
df_recent_missing_dates =  pd\
    .date_range(start=date_series.min(), end=date_series.max())\
    .difference(date_series)\
    .to_frame()\
    .reset_index()
df_recent_missing_dates.columns = [&#x27;holiday&#x27;, &#x27;ds&#x27;]
df_recent_missing_dates[&#x27;holiday&#x27;] = &#x27;Stock Market Closed&#x27;

# Create and fit our new model
m = Prophet(daily_seasonality=True, holidays=df_recent_missing_dates)
m.fit(df_recent_predict)

# Recreate our future predictions
future = m.make_future_dataframe(periods=365)
future = future[pd.to_datetime(future[&#x27;ds&#x27;]).dt.weekday &lt; 5]

# Forecast and visualize
forecast = m.predict(future)
m.plot(forecast, xlabel=&#x27;Date&#x27;, ylabel=&#x27;Daily Closing Price&#x27;)</code></span><button type="button" class="sc-bdvvtL dHMcRP"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="#abb2bf"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div></pre>
<div style="display:flex;justify-content:center" class="ZoomImageWrapper"><label><input type="checkbox" class="utils_displayNone__rveqn"/><img src="/images/forecasting-spy/second-prediction.jpg" width="800" height="480" class="postImg" alt="Second SPY forecast" loading="lazy"/></label></div>
<p>Now we can see a much wider confidence interval and a bit more of a bumpy forecast line; however, this looks much more realistic in terms of stock market prediction.</p>
<hr/>
<h2>Conclusion</h2>
<p>All in all, Facebook&#x27;s Prophet is a very fast, impressive, and strongly abstracted library.  The entire script, including reading in the data, training and forecasting two models, and plotting both of the forecasts took right around <strong>25 seconds</strong>.</p>
<p>I would love to see this tool in the hands of an actual data scientist to see the accuracy of the models they&#x27;d be able to create using Prophet.</p>
<hr/></article></main></div><footer class="footer_FooterContainer__oKXDJ"><div class="footer_Footer__wsKMY"><div class="footer_LeftFooterWrapper__ml0HU"><span class="footer_SocialLinkWrapper__0F2i_"><a href="https://www.linkedin.com/in/bradley-schoeneweis/" target="_blank" rel="noreferrer"><img width="16" src="/icons/linkedin.svg" alt="linkedin logo" class="footer_SocialLinkLogo__OWB_i"/></a><a href="https://github.com/bschoeneweis" target="_blank" rel="noreferrer"><img width="16" src="/icons/github.svg" alt="github logo" class="footer_SocialLinkLogo__OWB_i"/></a><a href="https://medium.com/@bradley-schoeneweis" target="_blank" rel="noreferrer"><img width="16" src="/icons/medium.svg" alt="medium logo" class="footer_SocialLinkLogo__OWB_i"/></a><a href="https://dev.to/bschoeneweis" target="_blank" rel="noreferrer"><img width="16" src="/icons/dev.svg" alt="dev logo" class="footer_SocialLinkLogo__OWB_i"/></a><a href="/feed.xml"><img width="16" src="/icons/rss.svg" alt="rss logo" class="footer_SocialLinkLogo__OWB_i"/></a></span></div><div class="footer_SiteLinks__nUPbv"><a href="/books">üìö</a><a href="/tools">üõ†</a></div></div><div class="footer_CopyrightWrapper__NZEPb"><small>¬© <time>2022</time> Bradley Schoeneweis</small></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"forecasting-spy-prices","contentHtml":"\u003ch2\u003etl;dr\u003c/h2\u003e\n\u003ch3\u003eGoal\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003eTo apply Facebook's Prophet forecasting procedure to historical SPY (SPDR S\u0026#x26;P 500 ETF Trust) market data to gather future pricing predictions.\u003c/em\u003e\u003c/p\u003e\n\u003ch3\u003eA few notes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eI'm by no means a data scientist, so this is more of an exploratory analysis than an accurate one\u003c/li\u003e\n\u003cli\u003eFor sake of brevity, I won't be using a training/test split or measuring the error of the model, I will just train the model on the entire dataset and then make a prediction\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eProcess overview\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eDownloading the data\u003c/strong\u003e - exporting the data from Yahoo Finance as a CSV\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eExploring the data\u003c/strong\u003e - loading and exploring the data using Pandas\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eFitting the model\u003c/strong\u003e - reading in the data and applying a basic fit of the Prophet model to the data\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVisualizing the forecast\u003c/strong\u003e - visualizing the forecasted pricing data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003ePython dependencies\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003eimport pandas as pd\nfrom prophet import Prophet\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003cp\u003eBefore we jump in, let's give a little background on SPY and on Facebook's Prophet.\u003c/p\u003e\n\u003cp\u003eThe \u003cem\u003eSPDR S\u0026#x26;P 500 ETF Trust\u003c/em\u003e (SPY) is an ETF (\u003cem\u003eExchange Traded Fund\u003c/em\u003e) that tracks the performance of the S\u0026#x26;P 500 index.  SPY is also the largest ETF in the world, and is popular compared to other ETFs that track the S\u0026#x26;P 500 because of the high volume, or the number of shares that trade on a given day (we'll be able to see the volume per day in the CSV we export from Yahoo Finance).\u003c/p\u003e\n\u003cp\u003eFor more information on ETFs, \u003ca href=\"https://www.investopedia.com/terms/e/etf.asp\"\u003eInvestopedia gives a good overview\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://facebook.github.io/prophet/\"\u003eFacebook Prophet\u003c/a\u003e is an open source, automated forecasting procedure for time series data.  I'm not going to dive too much into the mathematics or implementation details of Prophet, but if you are more interested, you can read the \u003ca href=\"https://peerj.com/preprints/3190/\"\u003eresearch paper\u003c/a\u003e.  Prophet makes it easy to handle outliers, adjust to different time intervals, deal with holidays, and leaves the ability to easily tune the forecasting model.\u003c/p\u003e\n\u003cp\u003eNow that we have a general idea of what we're trying to predict and the tool we'll use to forecast, let's dive into the actual data.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003eDownloading the data\u003c/h2\u003e\n\u003cp\u003eThanks to Yahoo Finance, we can download historical pricing data for free. You can click \u003ca href=\"https://finance.yahoo.com/quote/SPY/history?p=SPY\"\u003ehere\u003c/a\u003e to view the SPY historical pricing data.\u003c/p\u003e\n\u003cp\u003eClick on the \u003ccode\u003eHistorical Data\u003c/code\u003e tab, and then we can adjust our \u003ccode\u003eTime Period\u003c/code\u003e to the Max as seen below (back to January 1993).\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/forecasting-spy/export-data.jpg\" alt=\"Historical pricing data {priority}{680x243}\"\u003e\u003c/p\u003e\n\u003cp\u003eNow we can click download to get our CSV and start diving into the data.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003eExploring the data\u003c/h2\u003e\n\u003cp\u003eLet's fire up Pandas and load our data into a DataFrame to see what general insights we can extract.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003edf = pd.read_csv('SPY.csv')\n\n# Columns and row count\ndf.info()\n\"\"\"\n\u0026#x3C;class 'pandas.core.frame.DataFrame'\u003e\nRangeIndex: 7125 entries, 0 to 7124\nData columns (total 7 columns):\n #   Column     Non-Null Count  Dtype  \n---  ------     --------------  -----  \n 0   Date       7125 non-null   object \n 1   Open       7125 non-null   float64\n 2   High       7125 non-null   float64\n 3   Low        7125 non-null   float64\n 4   Close      7125 non-null   float64\n 5   Adj Close  7125 non-null   float64\n 6   Volume     7125 non-null   int64  \ndtypes: float64(5), int64(1), object(1)\nmemory usage: 389.8+ KB\n\"\"\"\n\n# Preview of the data\ndf.head()\n\"\"\"\n         Date      Open      High       Low     Close  Adj Close   Volume\n0  1993-01-29  43.96875  43.96875  43.75000  43.93750  25.884184  1003200\n1  1993-02-01  43.96875  44.25000  43.96875  44.25000  26.068277   480500\n2  1993-02-02  44.21875  44.37500  44.12500  44.34375  26.123499   201300\n3  1993-02-03  44.40625  44.84375  44.37500  44.81250  26.399649   529400\n4  1993-02-04  44.96875  45.09375  44.46875  45.00000  26.510111   531500\n\"\"\"\n\n# General statistics\ndf.describe().loc[['mean', 'min', 'max']]\n\"\"\"\n            Open        High         Low       Close   Adj Close        Volume\nmean  146.896395  147.766581  145.928716  146.896373  121.611954  8.453727e+07\nmin    43.343750   43.531250   42.812500   43.406250   25.571209  5.200000e+03\nmax   422.500000  422.820007  419.160004  422.119995  422.119995  8.710263e+08\n\"\"\"\n\n# Day to day percent changes of Highs\ndf[['Date', 'High']].set_index('Date').pct_change().reset_index()\n\"\"\"\n            Date      High\n0     1993-01-29       NaN\n1     1993-02-01  0.006397\n2     1993-02-02  0.002825\n3     1993-02-03  0.010563\n4     1993-02-04  0.005575\n         ...       ...\n7120  2021-05-10 -0.000189\n7121  2021-05-11 -0.017670\n7122  2021-05-12 -0.006454\n7123  2021-05-13 -0.000582\n7124  2021-05-14  0.012465\n\n[7125 rows x 2 columns]\n\"\"\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow that we know a bit more about our data in general, we can create a model using Prophet.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003eFitting the model\u003c/h2\u003e\n\u003cp\u003eSince we're not concerned in this post about making our model the best it can be, we can train our model on the entire dataset.\u003c/p\u003e\n\u003cp\u003eThis typically isn't a good practice.  When trying to make an accurate prediction, you should use training and test subsets of the data and calculate errors within your model and use those results to tune hyperparameters.\u003c/p\u003e\n\u003cp\u003eNevertheless, let's continue.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# The prophet model fits to a DataFrame with a date column (ds)\n# and a value to predict (y)\ndf_predict = df[['Date', 'Close']]\ndf_predict.columns = ['ds', 'y']\n\n# We can find all of the missing days within our dataset\n# and mark those as \"holidays\"\ndate_series = pd.to_datetime(df['Date'])\ndf_missing_dates = pd\\\n    .date_range(start=date_series.min(), end=date_series.max())\\\n    .difference(date_series)\\\n    .to_frame()\\\n    .reset_index()\ndf_missing_dates.columns = ['holiday', 'ds']\ndf_missing_dates['holiday'] = 'Stock Market Closed'\n\n# Fitting our model is incredibly simple and can be done in the\n# most basic sense in just two lines of code\nm = Prophet(daily_seasonality=True, holidays=df_missing_dates)\nm.fit(df_predict)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eJust like that, we have built our model for a forecast.  All we have left to do is generate dates to predict values for, and run the actual prediction.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003eVisualizing the forecast\u003c/h2\u003e\n\u003cp\u003eNow let's forecast with our model and visualize the results.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# Create a DataFrame with past and future dates (only weekdays)\nfuture = m.make_future_dataframe(periods=365)\nfuture = future[pd.to_datetime(future['ds']).dt.weekday \u0026#x3C; 5]\n\n# Now we can forecast and visualize in just two more lines of code\nforecast = m.predict(future)\nm.plot(forecast, xlabel='Date', ylabel='Daily Closing Price')\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/forecasting-spy/first-prediction.jpg\" alt=\"First SPY forecast {800x480}\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eA few things to notice\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe black dots are the training data points\u003c/li\u003e\n\u003cli\u003eThe blue outline is the confidence interval\u003c/li\u003e\n\u003cli\u003eThe line within the confidence interval is the actual forecast\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eBased on our results, we can see the forecast is fairly linear and the confidence interval is relatively narrow (due to the volume of date).  The behavior of the stock market since Covid-19 started back around February 2020 has be a little unorthodox, so let's narrow our model to be trained back to data starting in 2017 to see if there is an effect.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# Narrow down to start at 2017\ndf_recent_predict = df_predict.iloc[date_series[date_series.dt.year \u003e 2016].index]\ndate_series = pd.to_datetime(df_recent_predict['ds'])\ndf_recent_missing_dates =  pd\\\n    .date_range(start=date_series.min(), end=date_series.max())\\\n    .difference(date_series)\\\n    .to_frame()\\\n    .reset_index()\ndf_recent_missing_dates.columns = ['holiday', 'ds']\ndf_recent_missing_dates['holiday'] = 'Stock Market Closed'\n\n# Create and fit our new model\nm = Prophet(daily_seasonality=True, holidays=df_recent_missing_dates)\nm.fit(df_recent_predict)\n\n# Recreate our future predictions\nfuture = m.make_future_dataframe(periods=365)\nfuture = future[pd.to_datetime(future['ds']).dt.weekday \u0026#x3C; 5]\n\n# Forecast and visualize\nforecast = m.predict(future)\nm.plot(forecast, xlabel='Date', ylabel='Daily Closing Price')\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/forecasting-spy/second-prediction.jpg\" alt=\"Second SPY forecast {800x480}\"\u003e\u003c/p\u003e\n\u003cp\u003eNow we can see a much wider confidence interval and a bit more of a bumpy forecast line; however, this looks much more realistic in terms of stock market prediction.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eAll in all, Facebook's Prophet is a very fast, impressive, and strongly abstracted library.  The entire script, including reading in the data, training and forecasting two models, and plotting both of the forecasts took right around \u003cstrong\u003e25 seconds\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eI would love to see this tool in the hands of an actual data scientist to see the accuracy of the models they'd be able to create using Prophet.\u003c/p\u003e\n\u003chr\u003e\n","markdown":"\n## tl;dr\n\n### Goal\n_To apply Facebook's Prophet forecasting procedure to historical SPY (SPDR S\u0026P 500 ETF Trust) market data to gather future pricing predictions._\n\n### A few notes\n- I'm by no means a data scientist, so this is more of an exploratory analysis than an accurate one\n- For sake of brevity, I won't be using a training/test split or measuring the error of the model, I will just train the model on the entire dataset and then make a prediction\n\n### Process overview\n1. **Downloading the data** - exporting the data from Yahoo Finance as a CSV\n2. **Exploring the data** - loading and exploring the data using Pandas\n3. **Fitting the model** - reading in the data and applying a basic fit of the Prophet model to the data\n4. **Visualizing the forecast** - visualizing the forecasted pricing data\n\n### Python dependencies\n```python\nimport pandas as pd\nfrom prophet import Prophet\n```\n\n\u003cp style=\"background-color: orange; padding: 7px 20px; border-radius: 6px;\"\u003e\n    \u003cb\u003eImportant\u003c/b\u003e This article is not investment advice, please conduct your own due diligence. This is merely a simple analysis.\n\u003c/p\u003e\n\n---\n\nBefore we jump in, let's give a little background on SPY and on Facebook's Prophet.\n\nThe _SPDR S\u0026P 500 ETF Trust_ (SPY) is an ETF (_Exchange Traded Fund_) that tracks the performance of the S\u0026P 500 index.  SPY is also the largest ETF in the world, and is popular compared to other ETFs that track the S\u0026P 500 because of the high volume, or the number of shares that trade on a given day (we'll be able to see the volume per day in the CSV we export from Yahoo Finance).\n\nFor more information on ETFs, [Investopedia gives a good overview](https://www.investopedia.com/terms/e/etf.asp).\n\n[Facebook Prophet](https://facebook.github.io/prophet/) is an open source, automated forecasting procedure for time series data.  I'm not going to dive too much into the mathematics or implementation details of Prophet, but if you are more interested, you can read the [research paper](https://peerj.com/preprints/3190/).  Prophet makes it easy to handle outliers, adjust to different time intervals, deal with holidays, and leaves the ability to easily tune the forecasting model.\n\nNow that we have a general idea of what we're trying to predict and the tool we'll use to forecast, let's dive into the actual data.\n\n---\n\n## Downloading the data\nThanks to Yahoo Finance, we can download historical pricing data for free. You can click [here](https://finance.yahoo.com/quote/SPY/history?p=SPY) to view the SPY historical pricing data.\n\nClick on the `Historical Data` tab, and then we can adjust our `Time Period` to the Max as seen below (back to January 1993).\n\n![Historical pricing data {priority}{680x243}](/images/forecasting-spy/export-data.jpg)\n\nNow we can click download to get our CSV and start diving into the data.\n\n---\n\n## Exploring the data\nLet's fire up Pandas and load our data into a DataFrame to see what general insights we can extract.\n\n```python\ndf = pd.read_csv('SPY.csv')\n\n# Columns and row count\ndf.info()\n\"\"\"\n\u003cclass 'pandas.core.frame.DataFrame'\u003e\nRangeIndex: 7125 entries, 0 to 7124\nData columns (total 7 columns):\n #   Column     Non-Null Count  Dtype  \n---  ------     --------------  -----  \n 0   Date       7125 non-null   object \n 1   Open       7125 non-null   float64\n 2   High       7125 non-null   float64\n 3   Low        7125 non-null   float64\n 4   Close      7125 non-null   float64\n 5   Adj Close  7125 non-null   float64\n 6   Volume     7125 non-null   int64  \ndtypes: float64(5), int64(1), object(1)\nmemory usage: 389.8+ KB\n\"\"\"\n\n# Preview of the data\ndf.head()\n\"\"\"\n         Date      Open      High       Low     Close  Adj Close   Volume\n0  1993-01-29  43.96875  43.96875  43.75000  43.93750  25.884184  1003200\n1  1993-02-01  43.96875  44.25000  43.96875  44.25000  26.068277   480500\n2  1993-02-02  44.21875  44.37500  44.12500  44.34375  26.123499   201300\n3  1993-02-03  44.40625  44.84375  44.37500  44.81250  26.399649   529400\n4  1993-02-04  44.96875  45.09375  44.46875  45.00000  26.510111   531500\n\"\"\"\n\n# General statistics\ndf.describe().loc[['mean', 'min', 'max']]\n\"\"\"\n            Open        High         Low       Close   Adj Close        Volume\nmean  146.896395  147.766581  145.928716  146.896373  121.611954  8.453727e+07\nmin    43.343750   43.531250   42.812500   43.406250   25.571209  5.200000e+03\nmax   422.500000  422.820007  419.160004  422.119995  422.119995  8.710263e+08\n\"\"\"\n\n# Day to day percent changes of Highs\ndf[['Date', 'High']].set_index('Date').pct_change().reset_index()\n\"\"\"\n            Date      High\n0     1993-01-29       NaN\n1     1993-02-01  0.006397\n2     1993-02-02  0.002825\n3     1993-02-03  0.010563\n4     1993-02-04  0.005575\n         ...       ...\n7120  2021-05-10 -0.000189\n7121  2021-05-11 -0.017670\n7122  2021-05-12 -0.006454\n7123  2021-05-13 -0.000582\n7124  2021-05-14  0.012465\n\n[7125 rows x 2 columns]\n\"\"\"\n```\n\nNow that we know a bit more about our data in general, we can create a model using Prophet.\n\n---\n\n## Fitting the model\n\nSince we're not concerned in this post about making our model the best it can be, we can train our model on the entire dataset.\n\nThis typically isn't a good practice.  When trying to make an accurate prediction, you should use training and test subsets of the data and calculate errors within your model and use those results to tune hyperparameters.\n\nNevertheless, let's continue.\n\n```python\n# The prophet model fits to a DataFrame with a date column (ds)\n# and a value to predict (y)\ndf_predict = df[['Date', 'Close']]\ndf_predict.columns = ['ds', 'y']\n\n# We can find all of the missing days within our dataset\n# and mark those as \"holidays\"\ndate_series = pd.to_datetime(df['Date'])\ndf_missing_dates = pd\\\n    .date_range(start=date_series.min(), end=date_series.max())\\\n    .difference(date_series)\\\n    .to_frame()\\\n    .reset_index()\ndf_missing_dates.columns = ['holiday', 'ds']\ndf_missing_dates['holiday'] = 'Stock Market Closed'\n\n# Fitting our model is incredibly simple and can be done in the\n# most basic sense in just two lines of code\nm = Prophet(daily_seasonality=True, holidays=df_missing_dates)\nm.fit(df_predict)\n```\n\nJust like that, we have built our model for a forecast.  All we have left to do is generate dates to predict values for, and run the actual prediction.\n\n---\n\n## Visualizing the forecast\nNow let's forecast with our model and visualize the results.\n\n```python\n# Create a DataFrame with past and future dates (only weekdays)\nfuture = m.make_future_dataframe(periods=365)\nfuture = future[pd.to_datetime(future['ds']).dt.weekday \u003c 5]\n\n# Now we can forecast and visualize in just two more lines of code\nforecast = m.predict(future)\nm.plot(forecast, xlabel='Date', ylabel='Daily Closing Price')\n```\n\n![First SPY forecast {800x480}](/images/forecasting-spy/first-prediction.jpg)\n\n\u003e **A few things to notice**\n\u003e - The black dots are the training data points\n\u003e - The blue outline is the confidence interval\n\u003e - The line within the confidence interval is the actual forecast\n\nBased on our results, we can see the forecast is fairly linear and the confidence interval is relatively narrow (due to the volume of date).  The behavior of the stock market since Covid-19 started back around February 2020 has be a little unorthodox, so let's narrow our model to be trained back to data starting in 2017 to see if there is an effect.\n\n```python\n# Narrow down to start at 2017\ndf_recent_predict = df_predict.iloc[date_series[date_series.dt.year \u003e 2016].index]\ndate_series = pd.to_datetime(df_recent_predict['ds'])\ndf_recent_missing_dates =  pd\\\n    .date_range(start=date_series.min(), end=date_series.max())\\\n    .difference(date_series)\\\n    .to_frame()\\\n    .reset_index()\ndf_recent_missing_dates.columns = ['holiday', 'ds']\ndf_recent_missing_dates['holiday'] = 'Stock Market Closed'\n\n# Create and fit our new model\nm = Prophet(daily_seasonality=True, holidays=df_recent_missing_dates)\nm.fit(df_recent_predict)\n\n# Recreate our future predictions\nfuture = m.make_future_dataframe(periods=365)\nfuture = future[pd.to_datetime(future['ds']).dt.weekday \u003c 5]\n\n# Forecast and visualize\nforecast = m.predict(future)\nm.plot(forecast, xlabel='Date', ylabel='Daily Closing Price')\n```\n\n![Second SPY forecast {800x480}](/images/forecasting-spy/second-prediction.jpg)\n\nNow we can see a much wider confidence interval and a bit more of a bumpy forecast line; however, this looks much more realistic in terms of stock market prediction.\n\n---\n\n## Conclusion\n\nAll in all, Facebook's Prophet is a very fast, impressive, and strongly abstracted library.  The entire script, including reading in the data, training and forecasting two models, and plotting both of the forecasts took right around **25 seconds**.\n\nI would love to see this tool in the hands of an actual data scientist to see the accuracy of the models they'd be able to create using Prophet.\n\n---\n","title":"Forecasting SPY prices using Facebook's Prophet","date":"2021-05-19","tags":["python","pandas","data-analysis"],"description":"Using Facebook‚Äôs Prophet, an open-source, time series forecasting procedure to predict SPY (SPDR S\u0026P 500 ETF Trust) closing prices."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"forecasting-spy-prices"},"buildId":"PhTuDHTOFIz8jI2R6saCy","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>